<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>es.udc.lbs.hermes</groupId>
  <artifactId>hermes-common</artifactId>
  <version>0.0.1-SNAPSHOT</version>
  
  <name>hermes-common</name>
	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<!-- database.properties -->
		<development.datasource.jdbcUrlPostgres>jdbc:postgresql://localhost:5432/postgres</development.datasource.jdbcUrlPostgres>		
		<development.datasource.jdbcUrl>jdbc:postgresql://localhost:5432/meco1401_dev</development.datasource.jdbcUrl>
		<development.datasource.dataBaseName>meco1401_dev</development.datasource.dataBaseName>
		<development.datasource.user>postgres</development.datasource.user>
		<development.datasource.password>postgres</development.datasource.password>
		<development.jdbcDriver.groupId>org.postgresql</development.jdbcDriver.groupId>
		<development.jdbcDriver.artifactId>postgresql</development.jdbcDriver.artifactId>
		<development.jdbcDriver.version>9.3-1100-jdbc4</development.jdbcDriver.version>
		<development.jdbcDriver.className>org.postgresql.Driver</development.jdbcDriver.className>
		
		<production.datasource.jdbcUrlPostgres>jdbc:postgresql://cronos.lbd.org.es:5432/postgres</production.datasource.jdbcUrlPostgres>		
		<production.datasource.jdbcUrl>jdbc:postgresql://cronos.lbd.org.es:5432/meco1401_prod</production.datasource.jdbcUrl>
		<production.datasource.dataBaseName>meco1401_prod</production.datasource.dataBaseName>
		<production.datasource.user>***REMOVED***</production.datasource.user>
		<production.datasource.password>***REMOVED***</production.datasource.password>
		<production.jdbcDriver.groupId>org.postgresql</production.jdbcDriver.groupId>
		<production.jdbcDriver.artifactId>postgresql</production.jdbcDriver.artifactId>
		<production.jdbcDriver.version>9.3-1100-jdbc4</production.jdbcDriver.version>
		<production.jdbcDriver.className>org.postgresql.Driver</production.jdbcDriver.className>

		<version.sql-maven-plugin>1.4</version.sql-maven-plugin>
		
		<datasource.setupDBScript>01-PSQL-SetupDatabase.sql</datasource.setupDBScript>	
		<datasource.createTNUtilityScript>02-PSQL-CreateTNUtility.sql</datasource.createTNUtilityScript>	
		<datasource.createTNSchemaScript>03-PSQL-CreateTNSchema.sql</datasource.createTNSchemaScript>	
		<datasource.createEventsSchemaScript>04-PSQL-CreateEventsSchema.sql</datasource.createEventsSchemaScript>
		<datasource.createEventsDataScript>05-PSQL-CreateEventsData.sql</datasource.createEventsDataScript>
	</properties>

  <profiles>
		<profile>
			<id>development</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<!-- database.properties -->
				<datasource.jdbcUrl>${development.datasource.jdbcUrl}</datasource.jdbcUrl>
				<datasource.jdbcUrlPostgres>${development.datasource.jdbcUrlPostgres}</datasource.jdbcUrlPostgres>
				<datasource.dataBaseName>${development.datasource.dataBaseName}</datasource.dataBaseName>
				<datasource.user>${development.datasource.user}</datasource.user>
				<datasource.password>${development.datasource.password}</datasource.password>
				<datasource.jndiName>${development.datasource.jndiName}</datasource.jndiName>

				<!-- JDBC driver properties -->
				<jdbcDriver.groupId>${development.jdbcDriver.groupId}</jdbcDriver.groupId>
				<jdbcDriver.artifactId>${development.jdbcDriver.artifactId}</jdbcDriver.artifactId>
				<jdbcDriver.version>${development.jdbcDriver.version}</jdbcDriver.version>
				<jdbcDriver.className>${development.jdbcDriver.className}</jdbcDriver.className>
			</properties>
		</profile>
		<profile>
			<id>production</id>
			<activation>
				<activeByDefault>false</activeByDefault>
			</activation>
			<properties>
				<!-- database.properties -->
				<datasource.jdbcUrl>${production.datasource.jdbcUrl}</datasource.jdbcUrl>
				<datasource.jdbcUrlPostgres>${production.datasource.jdbcUrlPostgres}</datasource.jdbcUrlPostgres>
				<datasource.dataBaseName>${production.datasource.dataBaseName}</datasource.dataBaseName>
				<datasource.user>${production.datasource.user}</datasource.user>
				<datasource.password>${production.datasource.password}</datasource.password>
				<datasource.jndiName>${production.datasource.jndiName}</datasource.jndiName>

				<!-- JDBC driver properties -->
				<jdbcDriver.groupId>${production.jdbcDriver.groupId}</jdbcDriver.groupId>
				<jdbcDriver.artifactId>${production.jdbcDriver.artifactId}</jdbcDriver.artifactId>
				<jdbcDriver.version>${production.jdbcDriver.version}</jdbcDriver.version>
				<jdbcDriver.className>${production.jdbcDriver.className}</jdbcDriver.className>
			</properties>
		</profile>		
	</profiles>
  	
   <build>
		<plugins>
			<!-- ========================================================== -->
			<!-- Setting SQL Plugin -->
			<!-- - Configuartion specifies onError="continue" since SQL scripts try to drop tables before creating them (which causes 
				errors if such tables do not exist yet). - Configuartion specifies autocommit="true" since some drivers (e.g the PostgreSQL 
				JDBC 2 driver) do not commit changes if some error ocurrs. -->
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>sql-maven-plugin</artifactId>
				<version>${version.sql-maven-plugin}</version>
				<dependencies>
					<dependency>
						<groupId>${jdbcDriver.groupId}</groupId>
						<artifactId>${jdbcDriver.artifactId}</artifactId>
						<version>${jdbcDriver.version}</version>
					</dependency>
				</dependencies>
				<configuration>
					<driver>${jdbcDriver.className}</driver>
					<url>${datasource.jdbcUrl}</url>
					<username>${datasource.user}</username>
					<password>${datasource.password}</password>
					<autocommit>true</autocommit>
					<onError>continue</onError>
					<orderFile>ascending</orderFile>
				</configuration>
				<executions>
					<execution>
						<id>drop-db</id>
						<phase>clean</phase>
						<goals>
							<goal>execute</goal>
						</goals>						
						<configuration>
							<url>${datasource.jdbcUrlPostgres}</url>	
							<sqlCommand>drop database ${datasource.dataBaseName}</sqlCommand>
						</configuration>
					</execution>
					<execution>
						<id>create-db</id>
						<phase>install</phase>
						<goals>
							<goal>execute</goal>
						</goals>						
						<configuration>
							<url>${datasource.jdbcUrlPostgres}</url>	
							<sqlCommand>create database ${datasource.dataBaseName}</sqlCommand>
						</configuration>
					</execution>
					<execution>
						<id>setup-db</id>
						<phase>install</phase>
						<goals>
							<goal>execute</goal>
						</goals>						
						<configuration>
							<fileset>
								<basedir>${basedir}</basedir>
								<includes>
									<include>src/sql/${datasource.setupDBScript}</include>
								</includes>
							</fileset>
						</configuration>
					</execution>
					<execution>
						<id>create-utility</id>
						<phase>install</phase>
						<goals>
							<goal>execute</goal>
						</goals>						
						<configuration>
							<delimiterType>row</delimiterType>
							<fileset>
								<basedir>${basedir}</basedir>
								<includes>
									<include>src/sql/${datasource.createTNUtilityScript}</include>
								</includes>
							</fileset>
						</configuration>
					</execution>
					<execution>
						<id>create-schemas</id>
						<phase>install</phase>
						<goals>
							<goal>execute</goal>
						</goals>						
						<configuration>
							<fileset>
								<basedir>${basedir}</basedir>
								<includes>
									<include>src/sql/${datasource.createTNSchemaScript}</include>
									<include>src/sql/${datasource.createEventsSchemaScript}</include>
									<include>src/sql/${datasource.createEventsDataScript}</include>
								</includes>
							</fileset>
						</configuration>
					</execution>
				</executions>
			</plugin>
		</plugins>
  </build>


</project>